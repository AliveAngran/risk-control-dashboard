# 1. 背景：

用于管理雇佣制的做市商现货头寸，降低未知的平台风险。



# 2. 需求简述：

## 2.1 内部API 接口

1. 账户余额 - P0

2. 历史成交 - P0

3. 账户流水 - P0

4. 当前委托 - P1

## 2.2 做市报表

1. 分币对盈亏- P0

2. 多账户组余额盈亏 P0

3. 订单薄监控 P1

# 3. 需求说明：

## 3.1 内部API接口 jucoin

### 3.1.1 余额查询

通过内部接口获取多个UID 对应账户的余额信息:

* 现货：全部、可用、不可用；

```json
{
   "code": 200,
   "msg": "",
   "snapshotVos": [
      {
         "UID": "12345678",
         "data": {
            "balances": [
               {
                  "asset": "BTC",
                  "free": "0.09905021",
                  "locked": "0.00000000"
               },
               {
                  "asset": "USDT",
                  "free": "1.89109409",
                  "locked": "0.00000000"
               }
            ],
            "totalAssetOfBtc": "0.09942700"
         },
         "type": "spot",
         "updateTime": 1576281599000
      },
      {
         "UID": "87654321",
         "data": {
            "balances": [
               {
                  "asset": "ETH",
                  "free": "1.23456789",
                  "locked": "0.00000000"
               },
               {
                  "asset": "USDC",
                  "free": "500.00000000",
                  "locked": "0.00000000"
               }
            ],
            "totalAssetOfBtc": "2.34567890"
         },
         "type": "spot",
         "updateTime": 1576281600000
      }
   ]
}
```

### 3.1.2 获取成交信息

通过内部接口获取多个UID 对应账户的**订单成交**信息；

入参：

回参：（参考）

```json

{
  "code": 200,
  "msg": "string",
  "UID": 123456,123457,123458
  "msgInfo": [
    {}
  ],
  "data": {
    "hasPrev": true,
    "hasNext": true,
    "items": [
      {
        "symbol": "BTC_USDT",               //交易对
        "UID":123456
        "tradeId": "6316559590087222001",   //成交单号
        "orderId": "6216559590087220004",   //订单号
        "orderSide": "BUY",                 //订单方向
        "orderType": "LIMIT",               //订单类型
        "bizType": "SPOT",                  //业务类型
        "time": 1655958915583,              //成交时间
        "price": "40000",                   //成交价格
        "quantity": "1.2",                  //成交数量
        "quoteQty": "48000",                //成交金额
        "baseCurrency": "BTC",              //标的币种类型
        "quoteCurrency": "USDT",            //报价币种类型
        "fee": "0.5",                       //手续费资产金额
        "feeCurrency": "USDT",              //手续费资产类型
        "nftId": "000012313",               //nftId
        "symbolType": "nft",               //交易对类型
        "takerMaker": "taker"               //takerMaker
      }
    ]
  }
}
```



### 3.1.3 获取账户流水

通过内部接口获取多个UID 对应账户的**划转、分发**信息；

入参：



回参（参考）：

// 分发 from 为空 to 为 SPOT；



### 3.1.4 当前委托：

入参：





## 3.2 做市监控

### 3.2.1 币对监控报表

账户组概念；

#### 3.2.1.1 **日报**

* 报表说明：日级别汇报；

* 统计周期：UTC+8，每日00:00:00 ～ 23:59:59 数据；





#### 3.2.1.2 实时监控

* 报表说明：当日0点开始至今，实时盈亏监控；

* 监控频率：频率：3s 一次；

* 增加机器人盈亏超1000USD 报一次



### 3.2.2 做市账户组余额盈亏 - P0

#### 3.2.2.1 ~~账户组（按币种维度来）~~

~~Group ： Maker Ex ： Taker Ex  =  1 ：N：1~~

#### 3.2.2.2 **日报**

* 报表说明：日级别汇报；

* 统计周期：UTC+8，每日00:00:00 ～ 23:59:59 数据；

| Assets        | Maker Balance   | Maker Change       | Maker Net In TRF              | Taker Balance | Taker change | Taker Net In TRF              | Diff                                                        | Price | U-Pnl       |
| ------------- | --------------- | ------------------ | ----------------------------- | ------------- | ------------ | ----------------------------- | ----------------------------------------------------------- | ----- | ----------- |
| BTC           | 单账户             |                    |                               |               |              |                               |                                                             |       |             |
| ETH           | 单账户             |                    |                               |               |              |                               |                                                             |       |             |
| USDT          | Sum（所有 Maker账户） |                    |                               |               |              |                               |                                                             |       |             |
| 币种资产          |                 | 现货账户总资产当日变化（期初-期末） | 现货账户 该币种 当日净流入  = 转入 - 转出（划转） |               | 现货账户总资产当日变化  | 现货账户 该币种 当日净流入  = 转入 - 转出（划转） | （Taker change - Taker Net In）-（Maker change - Maker Net In） |       | Price\*Diff |
| Daily Summary |                 |                    |                               |               |              |                               |                                                             |       | Pnl sum     |





#### 3.2.2.3 实时监控

* 报表说明：实时资产监控；

* 监控频率：3s 一次；

| Assets | Maker Balance | Maker Net In            | Taker Balance | Taker Net In            | Diff                                                          | Price     | Pnl         |
| ------ | ------------- | ----------------------- | ------------- | ----------------------- | ------------------------------------------------------------- | --------- | ----------- |
| BTC    |               |                         |               |                         |                                                               |           |             |
|  币种资产  | 现货账户 总资产      | 现货账户 该币种 净流入  = 转入 - 转出 | 现货账户 总资产      | 现货账户 该币种 净流入  = 转入 - 转出 | （Taker Balance - Taker Net In）-（Maker Balance - Maker Net In） | 对冲交易所实时价格 | Price\*Diff |





## 3.3 公共表：

### 3.3.1 划转记录表：

获取对应划转记录保存在本地；

| UID    | Exchange | Assets | Amount    | Price      | USDT Value    | time            |
| ------ | -------- | ------ | --------- | ---------- | ------------- | --------------- |
| 121313 | BN       | BTC    | -0.100000 | 100,000.00 | 10,000.000000 | 123123123123123 |
|        |          |        |           |            |               |  时间戳            |

### 3.3.2 成交表：

取对冲交易所 和 做市交易所全部成交保存



币安成交推送：https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/user-data-streams/Event-Order-Update

币安成交轮询（补偿任务用）：https://developers.binance.com/docs/zh-CN/derivatives/usds-margined-futures/trade/rest-api/Account-Trade-List



#### 手续费特殊处理：

存在平台币抵扣手续费的情况，需要获取对应手续费币种的秒级别 K 线收盘价格，折算对应 USDT 价值；

| Fee asset | Fee amount  | Fee asset USDT price | Fee asset USDT amount |
| --------- | ----------- | -------------------- | --------------------- |
|           |             |                      |                       |



## 3.4 监控：

按币对区分：

| Pair | PnL limited | Notice   |
| ---- | ----------- | -------- |
|      |             | Lark     |
|      |             | ~~Call~~ |

告警方式：

* Lark 监控；

* ~~电话告警；~~





# 4. 表现形式：新增内容（0120）


先给我一份产品原型图和相应的描述，怎么办？






从风险管控报表.md中提取的关键需求：

报表需求：
1. 日报要求：
- UTC+8，每日00:00:00 ～ 23:59:59数据
- Maker/Taker账户组数据对比
- 需要计算净流入
- 需要显示币种资产当日变化

2. 实时监控：
- 当日0点开始至今的实时盈亏
- 3s更新一次
- 机器人盈亏超1000USD需要报警

告警需求：
- 按币对区分
- 支持PnL限制设置
- 通过Lark通知
- 需要记录告警历史

具体需求...

核心需求点:
1. 内部API接口
- 账户余额查询
- 历史成交查询
- 账户流水查询 
- 当前委托查询

2. 做市报表
- 分币对盈亏
- 多账户组余额盈亏
- 订单薄监控

3. 监控告警
- 按币对区分
- Lark通知

数据结构:
1. 账户余额数据包含:
- UID
- 币种
- 可用余额
- 冻结余额
- 总资产BTC价值

2. 成交数据包含:
- 交易对
- UID
- 成交ID
- 订单ID
- 方向
- 价格/数量等

3. 账户流水包含:
- 划转记录
- 分发记录

4. 监控数据包含:
- Maker/Taker账户组
- 日报数据
- 实时数据



# 风险管控管理后台UI设计方案 V2

## 一、实时监控大盘

![实时监控大盘](示意图)

```
+------------------------------------------------------------------------------------------------+
|  LOGO                    实时监控大盘                        2024-01-20 15:30:45   刷新间隔: 3s  |
+------------------------------------------------------------------------------------------------+
|        |                              总资产(USDT)                    24H净值变化                |
| 导航菜单 |   +------------------------+  +------------------------+  +------------------------+     |
|        |   |      Maker账户组        |  |      Taker账户组       |  |        整体盈亏        |    |
| 监控大盘 |   |    123,456,789.12     |  |    987,654,321.98     |  |    +123,456.78       |    |
| 账户管理 |   |    +1.23% ↑           |  |    -0.45% ↓           |  |    +0.78% ↑          |    |
| 报表分析 |   +------------------------+  +------------------------+  +------------------------+     |
| 告警配置 |                                                                                       |
|        |   +-----------------------------------------------------------------------+          |
|        |   |                            币对实时盈亏监控                              |          |
|        |   |                                                                         |          |
|        |   |  [BTC/USDT] [ETH/USDT] [其他币对...]                                   |          |
|        |   |                                                                         |          |
|        |   |  • 实时盈亏曲线图                                                       |          |
|        |   |  • 显示Maker/Taker账户对比                                              |          |
|        |   |  • 支持1H/4H/24H时间范围切换                                           |          |
|        |   |                                                                         |          |
|        |   +-----------------------------------------------------------------------+          |
|        |                                                                                        |
|        |   +-----------------------------------+  +----------------------------------+          |
|        |   |         账户组余额分布              |  |          实时告警信息              |          |
|        |   |                                   |  |                                  |          |
|        |   | • 饼图显示各币种占比               |  |  [严重] BTC/USDT盈亏超限          |          |
|        |   | • 支持Maker/Taker切换             |  |  时间: 15:28:30                  |          |
|        |   | • 显示24H变化                     |  |  详情: 盈亏-1500 USDT            |          |
|        |   |                                   |  |                                  |          |
|        |   +-----------------------------------+  +----------------------------------+          |
|        |                                                                                        |
|        |   +-----------------------------------------------------------------------+          |
|        |   |                            实时成交流水                                 |          |
|        |   |                                                                         |          |
|        |   | 时间              UID       币对    方向    价格      数量     成交额    |          |
|        |   | 15:30:42    123456   BTC/USDT    买入   45000   0.1234   5550.3    |          |
|        |   | 15:30:38    123457   ETH/USDT    卖出   2800    1.5678   4389.8    |          |
|        |   |                                                                         |          |
|        |   +-----------------------------------------------------------------------+          |
+--------+--------------------------------------------------------------------------------+
```

**页面要素说明：**

1. **顶部指标卡片**
   - Maker/Taker账户组总资产
   - 24小时净值变化
   - 整体盈亏情况
   - 所有数值支持正负值显示和趋势箭头

2. **币对实时盈亏监控**
   - 支持多币对Tab切换
   - 显示Maker/Taker账户对比曲线
   - X轴：时间(3s间隔更新)
   - Y轴：盈亏金额(USDT)
   - 提供1H/4H/24H时间范围切换
   - 鼠标悬停显示详细数据

3. **账户组余额分布**
   - 饼图展示各币种资产占比
   - 支持Maker/Taker账户组切换
   - 显示24小时变化比例
   - 点击饼图扇区显示详细数据

4. **实时告警信息**
   - 按严重程度分类(严重/警告/提示)
   - 显示告警时间、币对和具体数值
   - 支持快速处理和查看详情
   - 最多显示10条最新告警

5. **实时成交流水**
   - 实时更新最新成交记录
   - 显示关键成交信息
   - 支持按UID/币对筛选
   - 异常成交高亮显示

## 二、账户管理页面

![账户管理页面](示意图)

```
+------------------------------------------------------------------------------------------------+
|  LOGO                    账户管理                           2024-01-20 15:30:45                 |
+------------------------------------------------------------------------------------------------+
|        |   +-----------------------------------------------------------------------+          |
| 导航菜单 |   |                              查询条件                                  |          |
|        |   |                                                                         |          |
| 监控大盘 |   |  账户组: [Maker/Taker]  UID: [多选]  币种: [多选]  时间: [    -    ]   |          |
| 账户管理 |   |                                                    [查询] [导出]         |          |
| 报表分析 |   +-----------------------------------------------------------------------+          |
| 告警配置 |                                                                                       |
|        |   +-----------------------------------------------------------------------+          |
|        |   |                              账户余额信息                                |          |
|        |   |                                                                         |          |
|        |   |  UID    币种    可用余额    冻结余额    总资产(USDT)   24H变化   操作    |          |
|        |   |  123456  BTC    12.3456    0.0000     556,789.12    +1.2%    详情    |          |
|        |   |  123456  ETH    45.6789    1.2345     123,456.78    -0.5%    详情    |          |
|        |   |                                                                         |          |
|        |   +-----------------------------------------------------------------------+          |
|        |                                                                                        |
|        |   +-----------------------------------+  +----------------------------------+          |
|        |   |         余额变化趋势               |  |          出入金分析               |          |
|        |   |                                   |  |                                  |          |
|        |   | • 折线图显示余额变化              |  |  • 柱状图显示出入金情况           |          |
|        |   | • 支持多币种对比                  |  |  • 区分转入/转出                  |          |
|        |   | • X轴: 时间                      |  |  • X轴: 时间                     |          |
|        |   | • Y轴: 余额                      |  |  • Y轴: 金额                     |          |
|        |   |                                   |  |                                  |          |
|        |   +-----------------------------------+  +----------------------------------+          |
|        |                                                                                        |
|        |   +-----------------------------------------------------------------------+          |
|        |   |                              历史成交记录                                |          |
|        |   |                                                                         |          |
|        |   | 时间     订单ID   币对    方向    价格    数量    成交额    手续费      |          |
|        |   | 15:20:30  123...  BTC/USDT  买入  45000  0.1234  5550.3   0.555    |          |
|        |   |                                                                         |          |
|        |   +-----------------------------------------------------------------------+          |
+--------+--------------------------------------------------------------------------------+
```

**页面要素说明：**

1. **查询条件区域**
   - 账户组选择(Maker/Taker)
   - UID多选下拉框
   - 币种多选下拉框
   - 时间范围选择器
   - 查询和导出按钮

2. **账户余额信息表格**
   - 分页显示
   - 支持所有列排序
   - 重要数据高亮显示
   - 异常数据标红
   - 详情按钮弹窗显示更多信息

3. **余额变化趋势图**
   - 支持多币种曲线对比
   - 可选时间范围(1D/7D/30D)
   - 鼠标悬停显示详细数据
   - 支持数据缩放

4. **出入金分析图**
   - 柱状图显示转入转出情况
   - 不同颜色区分转入转出
   - 支持按币种筛选
   - 显示净流入/流出统计

5. **历史成交记录**
   - 分页显示最近成交
   - 支持复杂条件筛选
   - 异常成交标红
   - 支持导出数据


## 三、报表分析页面

![报表分析页面](示意图)

```
+------------------------------------------------------------------------------------------------+
|  LOGO                    报表分析                           2024-01-20 15:30:45                 |
+------------------------------------------------------------------------------------------------+
|        |   +-----------------------------------------------------------------------+          |
| 导航菜单 |   |                              报表筛选                                  |          |
|        |   |                                                                         |          |
| 监控大盘 |   |  报表类型: [日报/实时]  币对: [多选]  账户组: [Maker/Taker]            |          |
| 账户管理 |   |  时间范围: [2024-01-20] [00:00:00 - 23:59:59]        [查询] [导出]    |          |
| 报表分析 |   +-----------------------------------------------------------------------+          |
| 告警配置 |                                                                                       |
|        |   +-----------------------------------------------------------------------+          |
|        |   |                              Maker-Taker对账                            |          |
|        |   |                                                                         |          |
|        |   | 币种  Maker余额  Maker变化  Maker净流入  Taker余额  Taker变化  Taker净流入  差值  |          |
|        |   | BTC   12.3456   +0.1234    +0.5678     11.2345    -0.1234   -0.5678   0.0000 |          |
|        |   | ETH   45.6789   -1.2345    -2.3456     44.5678    +1.2345   +2.3456   0.0000 |          |
|        |   |                                                                         |          |
|        |   +-----------------------------------------------------------------------+          |
|        |                                                                                        |
|        |   +-----------------------------------+  +----------------------------------+          |
|        |   |         分币对盈亏分析              |  |          账户组净值走势            |          |
|        |   |                                   |  |                                  |          |
|        |   | • 堆叠柱状图                      |  |  • 双Y轴折线图                    |          |
|        |   | • X轴: 币对                      |  |  • X轴: 时间                     |          |
|        |   | • Y轴: 盈亏金额(USDT)            |  |  • Y1: Maker净值                 |          |
|        |   | • 区分Maker/Taker               |  |  • Y2: Taker净值                 |          |
|        |   |                                   |  |                                  |          |
|        |   +-----------------------------------+  +----------------------------------+          |
|        |                                                                                        |
|        |   +-----------------------------------------------------------------------+          |
|        |   |                              详细数据                                    |          |
|        |   |                                                                         |          |
|        |   | 时间              币对    Maker盈亏   Taker盈亏   净盈亏   Price   U-PnL |          |
|        |   | 2024-01-20  BTC/USDT   +123.45    -67.89     +55.56   45000  +2500  |          |
|        |   | 15:00:00    ETH/USDT   -45.67     +89.12     +43.45   2800   +1200  |          |
|        |   |                                                                         |          |
|        |   +-----------------------------------------------------------------------+          |
+--------+--------------------------------------------------------------------------------+
```

**页面要素说明：**

1. **报表筛选区域**
   - 报表类型切换(日报/实时)
   - 币对多选功能
   - 账户组选择
   - UTC+8时区日期选择
   - 导出Excel功能

2. **Maker-Taker对账表**
   - 显示各币种余额和变化
   - 计算净流入(转入-转出)
   - 自动计算差值
   - 异常差值标红
   - 支持列排序

3. **分币对盈亏分析**
   - 堆叠柱状图展示
   - 区分Maker/Taker盈亏
   - 显示净盈亏数据
   - 支持币对筛选
   - 鼠标悬停显示详情

4. **账户组净值走势**
   - 双Y轴展示Maker/Taker
   - 支持时间范围选择
   - 显示关键时间点标记
   - 净值异常波动标注

5. **详细数据表格**
   - 分页展示所有记录
   - 支持多维度排序
   - 重要指标高亮
   - 异常数据标红
   - 支持数据导出

## 四、告警配置页面

![告警配置页面](示意图)

```
+------------------------------------------------------------------------------------------------+
|  LOGO                    告警配置                           2024-01-20 15:30:45                 |
+------------------------------------------------------------------------------------------------+
|        |   +------------------------+  +------------------------+  +------------------------+      |
| 导航菜单 |   |     今日告警总数        |  |      待处理告警         |  |      已处理告警         |      |
|        |   |         156           |  |          23           |  |         133          |      |
| 监控大盘 |   +------------------------+  +------------------------+  +------------------------+      |
| 账户管理 |                                                                                        |
| 报表分析 |   +-----------------------------------------------------------------------+          |
| 告警配置 |   |                              告警规则配置                                |          |
|        |   |                                                                         |          |
|        |   |  币对      阈值(USDT)   监控周期   通知方式   状态    最近告警    操作     |          |
|        |   |  BTC/USDT   1000       3s        Lark     启用    15:28:30   编辑/删除 |          |
|        |   |  ETH/USDT   500        3s        Lark     启用    15:25:45   编辑/删除 |          |
|        |   |                                                                         |          |
|        |   |                                                    [新增规则]            |          |
|        |   +-----------------------------------------------------------------------+          |
|        |                                                                                        |
|        |   +-----------------------------------+  +----------------------------------+          |
|        |   |         告警统计分析               |  |          告警触发趋势              |          |
|        |   |                                   |  |                                  |          |
|        |   | • 饼图显示告警分布                |  |  • 折线图显示告警频率             |          |
|        |   | • 按币对/类型统计                 |  |  • X轴: 时间                     |          |
|        |   | • 显示告警比例                    |  |  • Y轴: 告警次数                 |          |
|        |   |                                   |  |                                  |          |
|        |   +-----------------------------------+  +----------------------------------+          |
|        |                                                                                        |
|        |   +-----------------------------------------------------------------------+          |
|        |   |                              告警历史记录                                |          |
|        |   |                                                                         |          |
|        |   | 时间      币对      触发值    阈值    状态    处理人    处理时间    备注   |          |
|        |   | 15:28:30  BTC/USDT  1234.56  1000   已处理   张三    15:29:00   风险解除 |          |
|        |   | 15:25:45  ETH/USDT  678.90   500    处理中   李四    -          处理中   |          |
|        |   |                                                                         |          |
|        |   +-----------------------------------------------------------------------+          |
+--------+--------------------------------------------------------------------------------+
```

**页面要素说明：**

1. **告警概览**
   - 今日告警总数统计
   - 待处理告警数量
   - 已处理告警数量
   - 数字变化动画效果

2. **告警规则配置**
   - 币对选择
   - PnL阈值设置(USDT)
   - 监控周期设置(默认3s)
   - Lark通知配置
   - 规则启用/停用
   - 快速编辑/删除

3. **告警统计分析**
   - 饼图展示告警分布
   - 按币对统计告警次数
   - 显示告警比例
   - 支持时间范围筛选

4. **告警触发趋势**
   - 折线图显示告警频率
   - 支持多币对对比
   - 显示告警密集时段
   - 关键时间点标注

5. **告警历史记录**
   - 分页显示告警记录
   - 状态标记(未处理/处理中/已处理)
   - 处理人和处理时间
   - 支持添加处理备注
   - 提供数据导出

**交互说明：**
1. 所有数据表格支持排序和筛选
2. 图表支持时间范围选择
3. 告警规则变更需二次确认
4. 重要操作需要权限验证
5. 告警处理支持快速操作


